"use strict";var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var BoardBackGround=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("img",{className:"board-background",src:"../svg/board.svg",width:this.props.size,height:this.props.size})}}]),t}(),Piece=function(e){function t(e){_classCallCheck(this,t);var s=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.state={x:e.x,y:e.y},s}return _inherits(t,React.Component),_createClass(t,[{key:"getSVGFromType",value:function(e){switch(e){case"white":default:return"../svg/white_piece.svg";case"black":return"../svg/black_piece.svg";case"fire":case"fire-ghost":return"../svg/fire_piece.svg"}}},{key:"render",value:function(){var e=.2*("fire-ghost"==this.props.type)*this.props.size;return React.createElement("img",{className:"piece",style:{left:this.state.x+e/2,top:this.state.y+e/2,opacity:"fire-ghost"==this.props.type?.5:1},src:this.getSVGFromType(this.props.type),width:this.props.size-e,height:this.props.size-e})}}]),t}(),ResignButton=function(e){function t(e){_classCallCheck(this,t);var s=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.width=100,s.height=50,s.margin=20,s}return _inherits(t,React.Component),_createClass(t,[{key:"onClick",value:function(){ws.send(JSON.stringify({type:"resign"})),mainComponent.setState({mode:"users-list"})}},{key:"render",value:function(){return React.createElement("p",{className:"resign-button",style:{left:parseInt(this.props.boardSize)+this.margin,top:(this.props.boardSize-this.height)/2,width:this.width,height:this.height},onClick:this.onClick},"Resign")}}]),t}(),Board=function(e){function t(e){_classCallCheck(this,t);var s=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.state={pieces:[{x:0,y:2,type:"white"},{x:5,y:3,type:"white"},{x:3,y:0,type:"black"},{x:2,y:5,type:"black"}],phase:"white"==e.myColor?0:2,activePieceIndex:-1},s.cellSize=s.props.size/6,s.key=0,s.onMouseDown=s.onMouseDown.bind(s),s.onMouseMove=s.onMouseMove.bind(s),s.onMouseUp=s.onMouseUp.bind(s),s.props.elements["game-board"]=s,s}return _inherits(t,React.Component),_createClass(t,[{key:"onMouseDown",value:function(e){if(0==this.state.phase){var t=e.pageX,s=e.pageY;"touchstart"==e.type&&(t=e.touches[0].pageX,s=e.touches[0].pageY);for(var i=e.currentTarget.getBoundingClientRect(),r=6*(t-i.left)/this.props.size,a=6*(s-i.top)/this.props.size,o=~~r,n=~~a,c=0;c<this.state.pieces.length;c++){var h=this.state.pieces[c];if(h.x==o&&h.y==n){if(h.type!=this.props.myColor)return;var p=this.state.pieces.copyWithin();p[c].x=r-.5,p[c].y=a-.5,this.setState({activePieceIndex:c,pieces:p}),this.lastI=o,this.lastJ=n}}}}},{key:"onMouseMove",value:function(e){if(0==this.state.phase&&-1!=this.state.activePieceIndex){var t=e.pageX,s=e.pageY;"touchmove"==e.type&&(t=e.touches[0].pageX,s=e.touches[0].pageY);var i=e.currentTarget.getBoundingClientRect(),r=6*(t-i.left)/this.props.size,a=6*(s-i.top)/this.props.size,o=this.state.pieces.copyWithin();o[this.state.activePieceIndex].x=r-.5,o[this.state.activePieceIndex].y=a-.5,this.setState({pieces:o})}}},{key:"onMouseUp",value:function(e){if(0==this.state.phase){if(-1==this.state.activePieceIndex)return;var t=this.state.activePieceIndex,s=this.state.pieces.copyWithin(),i=~~(s[t].x+.5),r=~~(s[t].y+.5);if(!this.moveIsValid(i,r))return s[t].x=this.lastI,s[t].y=this.lastJ,void this.setState({pieces:s,activePieceIndex:-1});s[t].x=i,s[t].y=r,ws.send(JSON.stringify({type:"move",prevX:this.lastI,prevY:this.lastJ,newX:i,newY:r})),this.setState({pieces:s,phase:1})}else if(1==this.state.phase){var a=e.pageX,o=e.pageY;"touchend"==e.type&&(a=e.touches[0].pageX,o=e.touches[0].pageY);var n=e.currentTarget.getBoundingClientRect(),c=~~(6*(a-n.left)/this.props.size),h=~~(6*(o-n.top)/this.props.size);if(this.lastI=this.state.pieces[this.state.activePieceIndex].x,this.lastJ=this.state.pieces[this.state.activePieceIndex].y,this.moveIsValid(c,h)){var p=this.state.pieces.copyWithin();p.push({x:c,y:h,type:"fire"}),ws.send(JSON.stringify({type:"fire",x:c,y:h})),this.opponentCantMove()&&(console.log("debug"),ws.send(JSON.stringify({type:"end-game"}))),this.setState({pieces:p,activePieceIndex:-1,phase:2})}}}},{key:"moveIsValid",value:function(e,t){if(e<0||e>5||t<0||t>5)return!1;if(e==this.lastI&&t==this.lastJ)return!1;if(e!=this.lastI&&t!=this.lastJ&&Math.abs(e-this.lastI)!=Math.abs(t-this.lastJ))return!1;var s=!0,i=!1,r=void 0;try{for(var a,o=this.state.pieces[Symbol.iterator]();!(s=(a=o.next()).done);s=!0){var n=a.value;if(~~n.x==n.x&&~~n.y==n.y&&!(n.x==this.lastI&&n.y==this.lastJ||n.x<Math.min(e,this.lastI)||n.x>Math.max(e,this.lastI)||n.y<Math.min(t,this.lastJ)||n.y>Math.max(t,this.lastJ)||(n.x-e)*(this.lastJ-t)!=(n.y-t)*(this.lastI-e)))return!1}}catch(e){i=!0,r=e}finally{try{!s&&o.return&&o.return()}finally{if(i)throw r}}return!0}},{key:"opponentCantMove",value:function(){var e=[{},{},{},{},{},{}],t=!0,s=!1,i=void 0;try{for(var r,a=this.state.pieces[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;e[o.x][o.y]=1}}catch(e){s=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(s)throw i}}var n=!0,c=!1,h=void 0;try{for(var p,l=this.state.pieces[Symbol.iterator]();!(n=(p=l.next()).done);n=!0){var u=p.value;if(u.type!=this.props.myColor&&"fire"!=u.type)for(var y=-1;y<=1;y++)for(var f=-1;f<=1;f++)if(0!=y||0!=f){var v=u.x+y,d=u.y+f;if(!(v<0||v>5||d<0||d>5||e[v][d]))return!1}}}catch(e){c=!0,h=e}finally{try{!n&&l.return&&l.return()}finally{if(c)throw h}}return!0}},{key:"render",value:function(){for(var e=[],t=0;t<this.state.pieces.length;t++)if(t!=this.state.activePieceIndex){var s=this.state.pieces[t];e.push(React.createElement(Piece,{x:s.x*this.cellSize,y:s.y*this.cellSize,type:s.type,size:this.cellSize,key:this.key++}))}if(0==this.state.phase||2==this.state.phase){if(-1!=this.state.activePieceIndex){var i=this.state.pieces[this.state.activePieceIndex],r=.1*this.cellSize;e.push(React.createElement(Piece,{x:i.x*this.cellSize-r/2,y:i.y*this.cellSize-r/2,type:i.type,size:this.cellSize+r,key:this.key++}))}}else if(1==this.state.phase){-1==this.state.activePieceIndex&&console.log("something isn't right...");var a=this.state.pieces[this.state.activePieceIndex];e.push(React.createElement(Piece,{x:a.x*this.cellSize,y:a.y*this.cellSize,type:a.type,size:this.cellSize,key:this.key++}));for(var o=-1;o<=1;o++)for(var n=-1;n<=1;n++)if(0!=o||0!=n)for(var c=a.x+o,h=a.y+n;c>=0&&c<=5&&h>=0&&h<=5;){var p=!1,l=!0,u=!1,y=void 0;try{for(var f,v=this.state.pieces[Symbol.iterator]();!(l=(f=v.next()).done);l=!0){var d=f.value;if(d.x==c&&d.y==h){p=!0;break}}}catch(e){u=!0,y=e}finally{try{!l&&v.return&&v.return()}finally{if(u)throw y}}if(p)break;e.push(React.createElement(Piece,{x:c*this.cellSize,y:h*this.cellSize,type:"fire-ghost",size:this.cellSize,key:this.key++})),c+=o,h+=n}}return React.createElement("div",{className:"board-wrapper",style:{width:this.props.size,left:(window.innerWidth-this.props.size)/2,top:50}},React.createElement("span",null,"You are playing as "+this.props.myColor+". It's your "+(2==this.state.phase?"opponents":"")+" move."),React.createElement("div",{className:"board",onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp,onTouchStart:this.onMouseDown,onTouchMove:this.onMouseMove,onTouchEnd:this.onMouseEnd},React.createElement(BoardBackGround,{size:this.props.size}),e,React.createElement(ResignButton,{boardSize:this.props.size})))}}]),t}();
